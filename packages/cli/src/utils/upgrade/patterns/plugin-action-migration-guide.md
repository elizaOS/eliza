# Plugin Action Migration Guide: V1 to V2 Specific Changes

`actions/[action-name].ts`: Imports `Action`, `HandlerCallback`, `IAgentRuntime`, `Memory`, `State`, `composeContext`, `generateObjectDeprecated`, `ModelClass`, `elizaLogger`. Needs update for: Remove `composeContext` and replace with `composePromptFromState`, replace `generateObjectDeprecated` with `runtime.useModel(ModelType.TEXT_LARGE, { prompt })` + `parseKeyValueXml(xmlResponse)` or `runtime.useModel(ModelType.OBJECT_LARGE, { prompt, schema, temperature: 0.1 })`, replace `ModelClass.LARGE/SMALL` with `ModelType.TEXT_LARGE/TEXT_SMALL`, update `ActionExample` format (add `name` field), update `Handler` signature (`state: State` → `state: State | undefined`), enhance state composition with `runtime.composeState(_message, ['RECENT_MESSAGES'], true)`, add plugin-specific context to `state` object, update action `name` to use descriptive prefix (`"actionName"` → `"PLUGIN_ACTION_NAME"`), enhance error handling with user-friendly messages and proper error categorization. `parseKeyValueXml` import needed for XML response parsing. `elizaLogger` usage remains similar but ensure consistent error logging patterns.

`actions/bridge.ts` (if applicable): Imports `Action`, `HandlerCallback`, `IAgentRuntime`, `Memory`, `State`, `composeContext`, `generateObjectDeprecated`, `ModelClass`. Needs update for: Same core transformations as above, plus add route status tracking with `Map<string, BridgeExecutionStatus>`, implement progress monitoring with callbacks, add gas optimization hooks in `ExecutionOptions`, add cross-chain completion polling with `getStatus` API, implement `updateRouteStatus` and `pollBridgeStatus` methods, add `resumeBridge` functionality, enhance error handling for bridge-specific failures (slippage, MEV protection, route failures). Advanced monitoring and retry logic required for cross-chain operations.

`actions/swap.ts` (if applicable): Imports `Action`, `HandlerCallback`, `IAgentRuntime`, `Memory`, `State`, `composeContext`, `generateObjectDeprecated`, `ModelClass`. Needs update for: Same core transformations as above, plus add token address resolution with `resolveTokenAddress` method using LiFi SDK, implement progressive slippage tolerance (1%, 1.5%, 2%) with retry logic, add comprehensive error categorization (`TRANSFER_FROM_FAILED`, `price movement`, `MEV frontrunning`, `reverted`), enhance user-friendly error messages, add transaction confirmation waiting with `waitForTransactionReceipt`, implement native token detection logic, add gas optimization with buffers (110% gas limit, 105% gas price). Multiple aggregator support (LiFi, Bebop) with quote comparison.

`actions/transfer.ts` (if applicable): Imports `Action`, `HandlerCallback`, `IAgentRuntime`, `Memory`, `State`, `composeContext`, `generateObjectDeprecated`, `ModelClass`. Needs update for: Same core transformations as above, plus add ERC20 token support with conditional logic (native vs token transfers), implement `resolveTokenAddress` method for symbol-to-address resolution, add token decimals detection with `readContract` calls, implement ERC20 transfer encoding with `encodeFunctionData`, add proper amount parsing with `parseUnits` using correct decimals, enhance validation for token existence and chain compatibility. Remove deprecated `kzg` properties from transaction requests.

`providers/[provider-name].ts`: Imports may include service-specific libraries, `IAgentRuntime`, `elizaLogger`. Needs update for: Update any `elizaLogger` usage to match V2 patterns, ensure service initialization follows V2 patterns, update any state management if provider interacts with agent state, check for deprecated core APIs. Provider patterns generally stable but verify compatibility with V2 runtime.

`types/index.ts`: Type definitions for plugin-specific interfaces. Needs update for: Update any references to `ModelClass` → `ModelType`, update `ActionExample` type if locally defined (add `name` field), ensure `HandlerCallback` signature matches V2 (content structure may have changed), update any state-related types if plugin defines custom state interfaces. Most type changes should be minimal but ensure compatibility.

`templates/[template-name].ts`: Template strings for prompt generation. Needs update for: Templates themselves usually don't need changes, but verify template usage in actions follows `composePromptFromState` pattern instead of `composeContext`, ensure state variables referenced in templates match enhanced state structure, add any new context variables needed for improved prompts (balance info, service status, etc.). Template content may need updates for better V2 prompt engineering.

`index.ts`: Imports `Plugin`, action exports, provider exports. Needs update for: Verify `Plugin` type usage matches V2 interface, ensure all action exports use updated V2 names (`EVM_BRIDGE_TOKENS` vs `bridge`), check that plugin dependencies and initialization follow V2 patterns, update plugin metadata if needed (description, version). Main plugin structure should remain stable.

`package.json`: Dependencies for plugin. Needs update for: Update `@elizaos/core` dependency to V2 version, verify all plugin-specific dependencies are compatible with V2, update any scripts that reference action names or CLI commands, ensure peer dependencies match V2 requirements. Dependency updates critical for compatibility.

`README.md` (if exists): Documentation for plugin usage. Needs update for: Update action names in examples (`bridge` → `EVM_BRIDGE_TOKENS`), update any code examples to show V2 patterns, verify installation instructions match V2 requirements, update configuration examples if state structure or initialization changed. Documentation should reflect V2 patterns for user guidance.
// End of Selection
