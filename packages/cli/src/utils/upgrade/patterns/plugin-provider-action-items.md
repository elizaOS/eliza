# **Provider Migration Changes Summary**

`src/providers/wallet.ts`: Imports `DeriveKeyProvider`, `TEEMode` from `@elizaos/plugin-tee`, `NodeCache`, `ICacheManager`, `IAgentRuntime`, `Provider`, `Memory`, `State`, `elizaLogger`. Needs update for: Remove external plugin imports (`DeriveKeyProvider`, `TEEMode` from `@elizaos/plugin-tee`), remove `NodeCache` and `ICacheManager` imports, add `ServiceType` and `ProviderResult` from `@elizaos/core`, add service constant imports (`[PLUGIN]_SERVICE_NAME`). Constructor signature change (`ICacheManager` -> `IAgentRuntime`), remove `NodeCache` initialization and caching properties (`private cache`, `CACHE_EXPIRY_SEC`), replace `currentContext` tracking with multi-context support. Method updates: replace `get[Resource]()` with `get[Resources]()` returning `Record<[ContextType], [ResourceType]>`, remove all manual caching methods (`getCachedData`, `setCachedData`), replace with `runtime.getCache/setCache`. Provider return type change from `Promise<string | null>` to `Promise<ProviderResult>`, add `name` property to provider, implement service integration with fallback to direct fetching, structure response with `text`, `data`, and `values` properties. TEE integration: replace external `DeriveKeyProvider` with `runtime.getService(ServiceType.TEE)`, implement `LazyTeeWalletProvider` for deferred initialization. Configuration updates: add fallback chain/context logic, improve error handling and logging with `elizaLogger.warn/error`.

`src/providers/get-balance.ts`: **NEW FILE** - Create token balance provider. Imports `IAgentRuntime`, `Memory`, `Provider`, `ProviderResult`, `ModelType`, `parseKeyValueXml` from `@elizaos/core`, `formatUnits`, `parseAbi`, `Address` from `viem`, `getToken` from `@lifi/sdk`, `initWalletProvider` from local wallet module, `SupportedChain` type. Implements dynamic provider with XML-based prompt parsing, token balance retrieval using LiFi SDK, structured `ProviderResult` response format with balance data, error handling for invalid requests.

`src/index.ts`: Imports `Plugin`, `Action`, `Provider` types. Needs update for: Add export for new token balance provider (`export { tokenBalanceProvider } from './providers/get-balance'`), ensure wallet provider export uses updated implementation, verify `Plugin` type usage matches V2 expectations (add `name` property if required), update any action exports if they depend on provider changes.

`src/constants.ts`: **LIKELY NEW FILE** - Add service name constants. Needs: Define `[PLUGIN]_SERVICE_NAME` constant for service integration, export for use in providers and service classes.

`package.json`: Dependencies section. Needs update for: Remove `node-cache` dependency, remove `@elizaos/plugin-tee` dependency (if used), add `@lifi/sdk` or equivalent external SDK dependencies for new providers, ensure `@elizaos/core` version supports `ServiceType` and `ProviderResult`.

`src/service.ts`: **LIKELY NEW FILE** - Implement EVM service class. Needs: Implement service class extending base service, provide `getCachedData()` method for service integration, manage wallet provider instances, handle multi-chain data caching, register with service name constant.

`src/types.ts`: Type definitions. Needs update for: Ensure `SupportedChain` or equivalent context types are properly exported, add any new types for service configuration, update existing types to match V2 patterns (remove single-context types, add multi-context support).
